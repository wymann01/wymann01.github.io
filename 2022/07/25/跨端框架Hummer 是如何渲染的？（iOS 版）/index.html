<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>è·¨ç«¯æ¡†æ¶Hummer æ˜¯å¦‚ä½•æ¸²æŸ“çš„ï¼Ÿï¼ˆiOS ç‰ˆ) | æ¹–ä¸­ç„‰å¾—æ›´æœ‰æ­¤äºº</title>
  <meta name="keywords" content="">
  <meta name="description" content="è·¨ç«¯æ¡†æ¶Hummer æ˜¯å¦‚ä½•æ¸²æŸ“çš„ï¼Ÿï¼ˆiOS ç‰ˆ) | æ¹–ä¸­ç„‰å¾—æ›´æœ‰æ­¤äºº">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="Hummerçš„é€šä¿¡æœºåˆ¶â€”â€” ä¸€ä¸ªè·¨ç«¯æ¡†æ¶åº”è¯¥è¦æ€ä¹ˆé€šä¿¡ï¼Ÿ ä¸–ç•Œä¸Šæœ‰å¾ˆå¤šè·¨ç«¯æ¡†æ¶ï¼Œæœ‰è‡ªå·±æŠŠåº•å±‚æ¸²æŸ“çš„å·¥ä½œéƒ½åŒ…äº†çš„ï¼Œé‚£ä¸ªå« Flutterï¼Œæœ‰é‚£ç§æŠŠå°ç¨‹åºè£…è¿› Appï¼Œç”¨ Webview æå®šé¡µé¢çš„ï¼Œç”¨å°ç¨‹åºæ¡†æ¶æ¥å®ç°è·¨ç«¯çš„ï¼Œè¿™ä¸ªæ»´æ»´å†…éƒ¨è‡ªç ”æœ‰ä¸€ä¸ªï¼Œå«æ˜Ÿæ²³ã€‚ è¿˜æœ‰ä¸€ç§æ›´ä¸ºå¸¸è§ï¼Œå°±æ˜¯åœ¨ Android å’Œ iOS éƒ½å®ç°ä¸€å¥— UIå’ŒåŸºç¡€ç±»ï¼Œç„¶åå¼€å‘è€…åªéœ€è¦ç¼–å†™ä¸€å¥—ä¸šåŠ¡ä»£ç å°±èƒ½ç»™ä¸¤ç«¯ç”¨ï¼Œè¿™ç§æœ‰ReactN">
<meta property="og:type" content="article">
<meta property="og:title" content="æ¹–ä¸­ç„‰å¾—æ›´æœ‰æ­¤äºº">
<meta property="og:url" content="http://example.com/2022/09/05/Hummer%E7%9A%84%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6/index.html">
<meta property="og:site_name" content="æ¹–ä¸­ç„‰å¾—æ›´æœ‰æ­¤äºº">
<meta property="og:description" content="Hummerçš„é€šä¿¡æœºåˆ¶â€”â€” ä¸€ä¸ªè·¨ç«¯æ¡†æ¶åº”è¯¥è¦æ€ä¹ˆé€šä¿¡ï¼Ÿ ä¸–ç•Œä¸Šæœ‰å¾ˆå¤šè·¨ç«¯æ¡†æ¶ï¼Œæœ‰è‡ªå·±æŠŠåº•å±‚æ¸²æŸ“çš„å·¥ä½œéƒ½åŒ…äº†çš„ï¼Œé‚£ä¸ªå« Flutterï¼Œæœ‰é‚£ç§æŠŠå°ç¨‹åºè£…è¿› Appï¼Œç”¨ Webview æå®šé¡µé¢çš„ï¼Œç”¨å°ç¨‹åºæ¡†æ¶æ¥å®ç°è·¨ç«¯çš„ï¼Œè¿™ä¸ªæ»´æ»´å†…éƒ¨è‡ªç ”æœ‰ä¸€ä¸ªï¼Œå«æ˜Ÿæ²³ã€‚ è¿˜æœ‰ä¸€ç§æ›´ä¸ºå¸¸è§ï¼Œå°±æ˜¯åœ¨ Android å’Œ iOS éƒ½å®ç°ä¸€å¥— UIå’ŒåŸºç¡€ç±»ï¼Œç„¶åå¼€å‘è€…åªéœ€è¦ç¼–å†™ä¸€å¥—ä¸šåŠ¡ä»£ç å°±èƒ½ç»™ä¸¤ç«¯ç”¨ï¼Œè¿™ç§æœ‰ReactN">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/image/image_bVcTLCP6tv.png">
<meta property="og:image" content="http://example.com/image/image_q210gVqEgd.png">
<meta property="og:image" content="http://example.com/image/image_eDrwX0JXxU.png">
<meta property="og:image" content="http://example.com/image/image_hTt0-neHh7.png">
<meta property="article:published_time" content="2022-09-05T07:35:16.000Z">
<meta property="article:modified_time" content="2022-09-05T15:39:00.341Z">
<meta property="article:author" content="æ·®">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/image/image_bVcTLCP6tv.png">


<link rel="icon" href="/avatar/westLake.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/gruvbox-dark.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 6.1.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/avatar/westLake.jpg"/>
</a>
<div class="author">
    <span>æ·®</span>
</div>

<div class="icon">
    
        
            <a title="github"
               href="https://github.com/wymann01"
               target="_blank">
                
                    <i class="iconfont icon-github"></i>
                
            </a>
        
    
        
            <a title="jianshu"
               href="https://www.jianshu.com/u/e8666e7ba998"
               target="_blank">
                
                    <i class="iconfont icon-jianshu"></i>
                
            </a>
        
    
        
            <a title="email"
               href="mailto:wymannpan@foxmail.com"
               target="_blank">
                
                    <i class="iconfont icon-email"></i>
                
            </a>
        
    
        
            <a title="qq"
               href="http://wpa.qq.com/msgrd?v=3&uin=1103584503&site=qq&menu=yes"
               target="_blank">
                
                    <i class="iconfont icon-qq"></i>
                
            </a>
        
    
</div>



    <a class="more-menus">æ›´å¤šèœå•</a>


<ul>
    <li>
        <div class="all active" data-rel="All">All
            
                <small>(6)</small>
            
        </div>
    </li>
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
                <a class="dynamic-menu site_url"
                   
                   href="/photo">ç›¸å†Œ</a>
        
            
                <a class="dynamic-menu "
                   target="_self"
                   
                   href="http://yelog.org/">å¶è½é˜</a>
        
            
                <a class="dynamic-menu "
                   target="_blank"
                        
                   href="https://github.com/yelog">github</a>
        
    </div>
    <div>
        
            <a class="about  site_url"
               
               href="/about">About</a>
        
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="6">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">å¶è½é˜</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="æœç´¢ å¿«æ·é”® i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="åˆ‡æ¢åˆ°å¤§çº²è§†å›¾ å¿«æ·é”® w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="è¿”å›"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="å¤§å°å†™æ•æ„Ÿ"></i>
            <i class="iconfont icon-tag" data-title="æ ‡ç­¾"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">å¤§çº²</div>
            <i class="iconfont icon-list" data-title="åˆ‡æ¢åˆ°æ–‡ç« åˆ—è¡¨"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        <a  class="All "
           href="/2022/09/05/Hummer%E7%9A%84%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6/"
           data-tag=""
           data-author="" >
            <span class="post-title" title=""></span>
            <span class="post-date" title="2022-09-05 15:35:16">2022/09/05</span>
        </a>
        
        <a  class="All "
           href="/2022/07/25/%E8%B7%A8%E7%AB%AF%E6%A1%86%E6%9E%B6Hummer%20%E6%98%AF%E5%A6%82%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%EF%BC%9F%EF%BC%88iOS%20%E7%89%88%EF%BC%89/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="è·¨ç«¯æ¡†æ¶Hummer æ˜¯å¦‚ä½•æ¸²æŸ“çš„ï¼Ÿï¼ˆiOS ç‰ˆ)">è·¨ç«¯æ¡†æ¶Hummer æ˜¯å¦‚ä½•æ¸²æŸ“çš„ï¼Ÿï¼ˆiOS ç‰ˆ)</span>
            <span class="post-date" title="2022-07-25 16:56:14">2022/07/25</span>
        </a>
        
        <a  class="All "
           href="/2022/05/22/%E5%85%B3%E4%BA%8ECocoapods%E4%BD%A0%E6%83%B3%E8%A6%81%E4%BA%86%E8%A7%A3%E7%9A%84%E4%B8%80%E5%88%87/"
           data-tag=""
           data-author="" >
            <span class="post-title" title=""></span>
            <span class="post-date" title="2022-05-22 10:04:32">2022/05/22</span>
        </a>
        
        <a  class="All "
           href="/2022/05/01/performSelector%20%E8%AF%A6%E8%A7%A3%E2%80%94%E2%80%94%E4%BB%8E%20What%20%E5%88%B0%20When/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="performSelector è¯¦è§£â€”â€”ä» What åˆ° When">performSelector è¯¦è§£â€”â€”ä» What åˆ° When</span>
            <span class="post-date" title="2022-05-01 22:55:14">2022/05/01</span>
        </a>
        
        <a  class="All "
           href="/2022/04/23/helloblog/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="hello blog">hello blog</span>
            <span class="post-date" title="2022-04-23 19:55:14">2022/04/23</span>
        </a>
        
        <a  class="All "
           href="/2022/04/23/hello-world/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Hello World">Hello World</span>
            <span class="post-date" title="2022-04-23 16:02:31">2022/04/23</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-è·¨ç«¯æ¡†æ¶Hummer æ˜¯å¦‚ä½•æ¸²æŸ“çš„ï¼Ÿï¼ˆiOS ç‰ˆï¼‰" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">è·¨ç«¯æ¡†æ¶Hummer æ˜¯å¦‚ä½•æ¸²æŸ“çš„ï¼Ÿï¼ˆiOS ç‰ˆ)</h1>
    
    <div class="article-meta">
        
        
        
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2022-07-25 16:56:23'>2022-07-25 16:56</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            Views ğŸ‘€ :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%A8%E7%AB%AF%E6%A1%86%E6%9E%B6Hummer-%E6%98%AF%E5%A6%82%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%EF%BC%9F%EF%BC%88iOS-%E7%89%88%EF%BC%89"><span class="toc-text">è·¨ç«¯æ¡†æ¶Hummer æ˜¯å¦‚ä½•æ¸²æŸ“çš„ï¼Ÿï¼ˆiOS ç‰ˆï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AE%9E%E4%BE%8B%E5%8C%96%EF%BC%9A%E3%80%8C%E7%89%B9%E5%88%AB%E9%B8%A3%E8%B0%A2%E4%BD%A0%E5%88%B6%E9%80%A0%E6%9B%B4%E6%AC%A2%E4%B9%90%E7%9A%84%E6%88%91%E3%80%8D"><span class="toc-text">1 å®ä¾‹åŒ–ï¼šã€Œç‰¹åˆ«é¸£è°¢ä½ åˆ¶é€ æ›´æ¬¢ä¹çš„æˆ‘ã€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E8%AE%BE%E7%BD%AE-style%EF%BC%9A"><span class="toc-text">2.1è®¾ç½® styleï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E8%AE%BE%E7%BD%AE-Property-%EF%BC%88%E6%AF%94%E5%A6%82-Text-%E7%9A%84-text-%E5%B1%9E%E6%80%A7%EF%BC%89"><span class="toc-text">2.2 è®¾ç½® Property ï¼ˆæ¯”å¦‚ Text çš„ text å±æ€§ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-render%E6%B8%B2%E6%9F%93"><span class="toc-text">3 renderæ¸²æŸ“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-markDirty%EF%BC%9A"><span class="toc-text">4 markDirtyï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-layout-%E5%B8%83%E5%B1%80"><span class="toc-text">5 layout å¸ƒå±€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E6%B5%8B%E4%B9%A0%E9%A2%98"><span class="toc-text">è‡ªæµ‹ä¹ é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="toc-text">å‚è€ƒæ–‡çŒ®</span></a></li></ol></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-6 i,
    .toc-level-6 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="è·¨ç«¯æ¡†æ¶Hummer-æ˜¯å¦‚ä½•æ¸²æŸ“çš„ï¼Ÿï¼ˆiOS-ç‰ˆï¼‰"><a href="#è·¨ç«¯æ¡†æ¶Hummer-æ˜¯å¦‚ä½•æ¸²æŸ“çš„ï¼Ÿï¼ˆiOS-ç‰ˆï¼‰" class="headerlink" title="è·¨ç«¯æ¡†æ¶Hummer æ˜¯å¦‚ä½•æ¸²æŸ“çš„ï¼Ÿï¼ˆiOS ç‰ˆï¼‰"></a>è·¨ç«¯æ¡†æ¶Hummer æ˜¯å¦‚ä½•æ¸²æŸ“çš„ï¼Ÿï¼ˆiOS ç‰ˆï¼‰</h1><p><a href="https://hummer.didi.cn/doc#/zh-CN/" title="Hummer"><strong>Hummer</strong></a>æ˜¯ç›®å‰æ»´æ»´è´§è¿å¸æœºç«¯æ­£åœ¨ä½¿ç”¨çš„è·¨ç«¯æ¡†æ¶ï¼Œä¹‹å‰åœ¨å¼€å‘éœ€æ±‚çš„æ—¶å€™ç¢°åˆ°äº†è¯¡å¼‚çš„å¸ƒå±€é—®é¢˜ï¼Œç”±äºè‡ªå·±æ˜¯åˆšæ¥è§¦ï¼Œå®Œå…¨ä¸çŸ¥é“ä»å“ªé‡Œä¸‹æ‰‹æ’æŸ¥é—®é¢˜ï¼Œäºæ˜¯è¯·æ¥äº†å…„å¼Ÿéƒ¨é—¨ Hummer iOS ç°åœ¨çš„ç»´æŠ¤è€…å²å¹¿è¿œï¼Œçœ‹ç€ä»–ä¸€æ­¥ä¸€æ­¥åœ°æ‰“æ–­ç‚¹ï¼Œæ‰“æ—¥å¿—ï¼Œæœ€ç»ˆæˆåŠŸå®šä½é—®é¢˜ï¼Œç»™å‡ºäº†è§£å†³æ–¹æ¡ˆã€‚å¿ƒé‡Œæ•¬ä½©å¾—å¾ˆã€‚</p>
<p>æ‰€ä»¥æ—¢ä¸ºäº†ä»¥åå¼€å‘èƒ½å¤Ÿæœ‰ç‹¬ç«‹æ’æŸ¥é—®é¢˜çš„èƒ½åŠ›ï¼Œä¹Ÿä¸ºäº†æé«˜è‡ªå·±å¯¹äºè·¨ç«¯æŠ€æœ¯çš„ç†è§£ï¼Œè¿™å°±æ¥æ•´ç†äº†ä¸‹Hummer çš„æ¸²æŸ“æœºåˆ¶ï¼Œæˆ‘çœ‹ä»¥åè¿˜æœ‰ä»€ä¹ˆé—®é¢˜èƒ½éš¾å€’æˆ‘ï¼Ÿ</p>
<p><img src="/image/image_APZMBxd5cB.png"></p>
<hr>
<p>ä»æˆ‘ä»¬çš„é¢˜ç›®å¼€å§‹ï¼š<strong>Hummeråœ¨ iOS ä¾§æ˜¯å¦‚ä½•æ¸²æŸ“çš„ï¼Ÿ</strong></p>
<p>å¦‚åŒæŠŠå¤§è±¡å¡è¿›å†°ç®±ï¼Œæˆ‘åˆ†ä¸º 5 æ­¥ï¼š</p>
<ol>
<li>åˆ›å»ºï¼šæŠŠç»„ä»¶å®ä¾‹åŒ–ï¼Œåˆ›å»ºå‡ºæ¥</li>
<li>è®¾ç½®ï¼šè®¾ç½®å®ƒçš„ style å’Œå±æ€§</li>
<li>æ¸²æŸ“ï¼šæŠŠå‡†å¤‡å¥½çš„ç»„ä»¶æ·»åŠ åˆ° yoga èŠ‚ç‚¹æ ‘ä¸Šï¼Œä¹Ÿæ˜¯æ·»åŠ åˆ°å±å¹•ä¸Š</li>
<li>æ ‡è®°ï¼šæ ‡è®°éœ€è¦é‡æ–°è®¡ç®—ã€åˆ·æ–°çš„ç»„ä»¶</li>
<li>å¸ƒå±€ï¼šè°ƒç”¨ yoga å¯¹ç»„ä»¶è¿›è¡Œå¸ƒå±€</li>
</ol>
<hr>
<blockquote>
<p>Hummer æ—¢å¯ä»¥ç”¨ TypeScript å†™ï¼Œä¹Ÿå¯ä»¥ç”¨Tenon å†™ï¼Œæœ¬æ–‡é‡‡ç”¨ç¬¬ä¸€ç§å†™æ³•ã€‚</p>
</blockquote>
<p>é¦–å…ˆæ¥çœ‹ç”¨<strong>TypeScript</strong> å†™çš„ä¸šåŠ¡ä»£ç ï¼š</p>
<pre><code class="typescript">import &#123;Hummer,View, Text&#125; from &#39;@hummer/hummer-front&#39;
class RootView extends View &#123;
  constructor() &#123;
    super();
    this.style = &#123;
      width: &#39;100%&#39;,
      height: &#39;100%&#39;,
      alignItems: &#39;flex-start&#39;,
      justifyContent: &#39;center&#39;
    &#125;
    // åˆ›å»ºäº†ä¸€ä¸ª Text ç»„ä»¶
    var text = new Text()
    text.style = &#123;
      fontSize: 20
    &#125;
    text.text = &#39;~ Hello Hummer ~&#39;
    this.appendChild(text);
  &#125;
&#125;

// æ ¹é¡µé¢æ¸²æŸ“
Hummer.render(new RootView());
</code></pre>
<p>ç®€å•ï¼Œå¤©çœŸï¼Œå‡ ä¹åªå†™äº†ä¸€ä¸ª <strong>Text</strong> ç»„ä»¶ã€‚</p>
<h3 id="1-å®ä¾‹åŒ–ï¼šã€Œç‰¹åˆ«é¸£è°¢ä½ åˆ¶é€ æ›´æ¬¢ä¹çš„æˆ‘ã€"><a href="#1-å®ä¾‹åŒ–ï¼šã€Œç‰¹åˆ«é¸£è°¢ä½ åˆ¶é€ æ›´æ¬¢ä¹çš„æˆ‘ã€" class="headerlink" title="1 å®ä¾‹åŒ–ï¼šã€Œç‰¹åˆ«é¸£è°¢ä½ åˆ¶é€ æ›´æ¬¢ä¹çš„æˆ‘ã€"></a>1 å®ä¾‹åŒ–ï¼šã€Œç‰¹åˆ«é¸£è°¢ä½ åˆ¶é€ æ›´æ¬¢ä¹çš„æˆ‘ã€</h3><p>åœ¨æ‰§è¡Œ var text &#x3D; new Text() æ—¶ï¼Œåœ¨ Native ä¾§å°±å¾—<strong>åˆ›å»ºä¸€ä¸ª HMLabelå®ä¾‹ï¼Œå¹¶ä¸”è¦æŠŠå®ä¾‹è£…å…¥ä¸€ä¸ª JS å¯¹è±¡ä¸­è¿”å›ç»™ JS</strong>ï¼Œå®ƒè¿˜å¾—æŒæœ‰ä¸€ä¸‹ã€‚è¿™ä¸€æ­¥äº¤ç»™è°æ¥åš â€”â€”<strong>hummerCreate</strong>: å‡½æ•°ã€‚</p>
<blockquote>
<p>1 è°ƒç”¨ HumemrBase çš„ constructor æ–¹æ³•<br>2 æ ¹æ® name å±æ€§è·å– className &amp; check cache<br>3è°ƒç”¨ globalThis çš„ hummerCreate æ–¹æ³•ç”Ÿæˆ native å¯¹åº”çš„è§†å›¾å®ä¾‹ &amp; è¢« this._ptivate æŒæœ‰<br>â€”â€”ã€Šè·¨ç«¯æ¡†æ¶ Hummer é€šä¿¡æœºåˆ¶ - iOS ç‰ˆã€‹</p>
</blockquote>
<pre><code class="objective-c">JSValueRef _Nullable hummerCreate(JSContextRef ctx, JSObjectRef function, JSObjectRef thisObject, size_t argumentCount, const JSValueRef _Nonnull arguments[], JSValueRef *exception) &#123;
    HMAssertMainQueue(); 
    if (argumentCount &lt; 2) &#123;
        HMLogError(HUMMER_CREATE_ERROR);

        return NULL;
    &#125;
    HMJSCExecutor *executor = (HMJSCExecutor *) [HMExecutorMap objectForKey:[NSValue valueWithPointer:JSContextGetGlobalContext(ctx)]];
    NSString *className = [executor convertValueRefToString:arguments[0] isForce:NO];
    if (className.length == 0) &#123;
        HMLogError(HUMMER_CREATE_ERROR);
        return NULL;
    &#125;
    // è·å–å¯¼å‡ºç±»
    HMExportClass *exportClass = HMExportManager.sharedInstance.jsClasses[className];
    NSString *objcClassName = exportClass.className;
    if (objcClassName.length == 0) &#123;
        HMLogError(HUMMER_CREATE_CLASS_NOT_FOUND, className);

        return NULL;
    &#125;
    // className æ˜¯ Hummer ä¾§çš„ç±»åï¼ˆæ¯”å¦‚ Textï¼‰
    // objcClassName æ˜¯ Native ä¾§çš„ç±»åï¼ˆæ¯”å¦‚ HMLabelï¼‰
    Class clazz = NSClassFromString(objcClassName);
    if (!clazz) &#123;
        HMLogError(HUMMER_CREATE_CLASS_NOT_FOUND, className);
        return NULL;
    &#125;

    // jscallå›è°ƒ
    HMJSContext *context = [[HMJSGlobal globalObject] currentContext:executor];
    
    // åˆ›å»ºä¸é€æ˜æŒ‡é’ˆ
    NSObject *opaquePointer = NULL;
    NSMutableArray&lt;HMBaseValue *&gt; *argumentArray = nil;
    for (int i = 2; i &lt; argumentCount; ++i) &#123;
        HMBaseValue *value = [[HMJSCStrongValue alloc] initWithValueRef:arguments[i] executor:executor];
        if (!argumentArray) &#123;
            argumentArray = [NSMutableArray arrayWithCapacity:argumentCount - 2];
        &#125;
        if (value) &#123;
            [argumentArray addObject:value];
        &#125;
    &#125;
#ifdef HMDEBUG
    [HMJSCallerInterceptor callNativeWithClassName:className functionName:@&quot;constructor&quot; objectRef:nil args:argumentArray context:context];
#endif
    HMCurrentExecutor = executor;
    // æ”¯æŒ HMJSObjectï¼Œå¦‚æœä¸æ”¯æŒåˆ™å›é€€ init
    // ä¸åˆ¤æ–­ argumentCount &gt; 2ï¼Œå› ä¸º UIView å¿…é¡»è°ƒç”¨ HMJSObject åˆå§‹åŒ–æ–¹æ³•
    if ([clazz conformsToProtocol:@protocol(HMJSObject)]) &#123;
        opaquePointer = (id) [(id) [clazz alloc] initWithHMValues:argumentArray];
    &#125; else &#123;
        HMOtherArguments = argumentArray.copy;
        opaquePointer = [[clazz alloc] init];
    &#125;
    HMCurrentExecutor = nil;
    HMOtherArguments = nil;
    if (!opaquePointer) &#123;
        HMLogError(HUMMER_CAN_NOT_CREATE_NATIVE_OBJECT, className);
        return NULL;
    &#125;
    // å…³è” hm_value
    opaquePointer.hmValue = [[HMJSCStrongValue alloc] initWithValueRef:arguments[1] executor:executor];
    // å¼•ç”¨è®¡æ•° +1
    HMLogDebug(HUMMER_CREATE_TEMPLATE, className);
    JSClassDefinition hostObjectClassDef = kJSClassDefinitionEmpty;
    hostObjectClassDef.version = 0;
    hostObjectClassDef.attributes = kJSClassAttributeNoAutomaticPrototype;
    hostObjectClassDef.finalize = hummerFinalize;
    JSClassRef hostObjectClass = JSClassCreate(&amp;hostObjectClassDef);

    // å¡«å……ä¸é€æ˜æŒ‡é’ˆ
    JSObjectRef objectRef = JSObjectMake(ctx, hostObjectClass, (__bridge void *) opaquePointer);
    if (objectRef) &#123;
        CFRetain((__bridge CFTypeRef) opaquePointer);
    &#125;
    JSClassRelease(hostObjectClass);

    return objectRef;
&#125;
</code></pre>
<p>è¿™ä¸ªå‡½æ•°åšäº†ï¼š</p>
<ol>
<li>æ ¹æ® Hummer ä¾§ä¼ è¿‡æ¥çš„æ¶ˆæ¯è·å–åˆ°äº†åœ¨ Native ä¾§æ³¨å†Œçš„ç±»</li>
<li>åˆ›å»ºè¿™ä¸ªç±»</li>
<li>åˆ›å»ºä¸é€æ˜æŒ‡é’ˆï¼ŒæŠŠè¿™ä¸ªç±»å¡«åˆ°ä¸é€æ˜æŒ‡é’ˆå½“ä¸­</li>
<li>è¿”å›ä¸é€æ˜æŒ‡é’ˆ</li>
</ol>
<p><strong>å†æ¬¡å¼ºè°ƒ</strong>ï¼šæœ€ç»ˆè¿”å›çš„æ˜¯<strong>JSObjectRef</strong> å¯¹è±¡ï¼Œä¸æ˜¯ç®€å•çš„ <strong>HMLabel</strong> å¯¹è±¡ã€‚</p>
<p>æˆ‘çŒœæµ‹è¿™æ ·åšçš„åŸå› æ˜¯ Nativeéœ€è¦è·Ÿ JavaScriptCore è¿›è¡Œé€šä¿¡ï¼Œåªåˆ›å»ºä¸€ä¸ª HMLabel ä½ æ€ä¹ˆè·Ÿ Hummer ä¾§è¿›è¡Œäº¤æµï¼Œåç»­ Hummer æ€ä¹ˆæ‹¿åˆ°è¿™ä¸ªå¯¹è±¡è¿›è¡Œè®¾ç½®ï¼Ÿ</p>
<h3 id="2-1è®¾ç½®-styleï¼š"><a href="#2-1è®¾ç½®-styleï¼š" class="headerlink" title="2.1è®¾ç½® styleï¼š"></a>2.1è®¾ç½® styleï¼š</h3><p>HMLabel åˆ›å»ºå‡ºæ¥åï¼Œå°±éœ€è¦è®¾ç½®å®ƒçš„æ ·å¼ï¼Œæ¯”å¦‚ heightã€widthç­‰ã€‚Hummer ä¾§ä¼šä¸€ä¸ªå‘ setStyle çš„ä¿¡å·ï¼ŒNativeä¼šè°ƒç”¨hm_setStyle: æ–¹æ³•</p>
<blockquote>
<p>è¿™å±‚è½¬åŒ–æ˜¯é€šè¿‡ HM_EXPORT_PROPERTY è¿™ä¸ªå®å®ç°çš„</p>
</blockquote>
<pre><code class="objective-c">- (void)hm_setStyle:(HMBaseValue *)style &#123;
    // è½¬åŒ–äº¤ç»™ HMJSCExecutor å®Œæˆ
    id styleObject = style.toDictionary;
    NSDictionary *styleDic = nil;
    if ([styleObject isKindOfClass:NSDictionary.class]) &#123;
        styleDic = styleObject;
    &#125;
    if (styleDic.count == 0) &#123;
        HMLogError(@&quot;style å¿…é¡»æœ‰é”®å€¼å¯¹&quot;);
        return;
    &#125;
    // æŠŠ style ä¿¡æ¯åˆ’åˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼šå¸ƒå±€ã€å±æ€§ï¼ˆæ ·å¼ï¼‰ã€è¿‡æ¸¡ä¿¡æ¯ï¼ˆåŠ¨ç”»ç›¸å…³ï¼‰
    NSMutableDictionary&lt;NSString *, NSObject *&gt; *layoutInfo = NSMutableDictionary.dictionary;
    NSMutableDictionary&lt;NSString *, NSObject *&gt; *attributes = NSMutableDictionary.dictionary;
    NSMutableDictionary&lt;NSString *, NSObject *&gt; *transitions = NSMutableDictionary.dictionary;
    [styleDic enumerateKeysAndObjectsUsingBlock:^(id key, id obj, BOOL *stop) &#123;
        if (![key isKindOfClass:NSString.class]) &#123;
            return;
        &#125;
        
        // æ¯”å¦‚ leftï¼ŒflexDirection
        if ([[self hm_layoutInfoKeys] containsObject:key]) &#123;
            layoutInfo[key] = obj;
        &#125; else if ([[self hm_transtionInfoKeys] containsObject:key]) &#123;
        // æ¯”å¦‚ transitionDelayï¼Œ
            transitions[key] = obj;
        &#125; else &#123;
        // æ¯”å¦‚ backgroundColor
            attributes[key] = obj;
        &#125;
        // å¸ƒå±€ã€å±æ€§å’Œè¿‡æ¸¡ä¿¡æ¯å¯ä»¥çœ‹æ–‡æ¡£ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆ
        // https://hummer.didi.cn/doc#/zh-CN/normal_view_style
    &#125;];

    NSMutableDictionary&lt;NSString *, NSObject *&gt; *mutableStyleDictionary = self.hm_styleStore.mutableCopy;
    if (!mutableStyleDictionary) &#123;
        mutableStyleDictionary = [NSMutableDictionary dictionaryWithCapacity:layoutInfo.count + attributes.count + transitions.count];
    &#125;
    // æŠŠåˆ†å¥½çš„ä¸‰éƒ¨åˆ†åˆè£…äº†å›å»ï¼Œè®© self.hm_styleStore æŒæœ‰
    self.hm_styleStore = nil;
    [mutableStyleDictionary addEntriesFromDictionary:layoutInfo];
    [mutableStyleDictionary addEntriesFromDictionary:attributes];
    [mutableStyleDictionary addEntriesFromDictionary:transitions];
    self.hm_styleStore = mutableStyleDictionary;

    ...
    [attributes enumerateKeysAndObjectsUsingBlock:^(NSString *key, NSObject *obj, BOOL *stop) &#123;
        // è¿‡æ»¤éœ€è¦åŠ¨ç”»çš„å±æ€§ï¼Œé€šè¿‡åŠ¨ç”»å±•ç¤º
        if (self.hm_transitionAnimation &amp;&amp; [self.hm_transitionAnimation.needAnimations.allKeys containsObject:key]) &#123;
            [transitionAnimations addEntriesFromDictionary:@&#123;key: obj&#125;];
        &#125; else &#123;
            // layoutInfoã€attributes å°±é€šè¿‡è¿™ä¸ªè®¾ç½®
            [self hm_configureWithTarget:self cssAttribute:key value:obj converterManager:HMAttrManager.sharedManager];
        &#125;
    &#125;];
    
    ...
    // æ ‡è®°ï¼šè¯¥ç»“ç‚¹éœ€è¦é‡æ–°è®¡ç®—ä½ç½®
    [self hm_markDirty];
&#125;
</code></pre>
<p>ç”¨æˆ‘æ˜“ï¼ˆç²—ï¼‰æ‡‚ï¼ˆæš´ï¼‰çš„è¯­è¨€è¯´å°±æ˜¯ï¼š</p>
<ol>
<li>HMJSCExecutor æŠŠ Hummer ä¾§çš„ style å­—å…¸è½¬æˆNSDictionary</li>
<li>æŠŠNSDictionaryé‡Œçš„å…ƒç´ åˆ’åˆ†æˆä¸‰ç§ä¸åŒçš„ styleï¼šå¸ƒå±€ã€å±æ€§ã€è¿‡æ¸¡ç›¸å…³çš„</li>
<li>è®¾ç½®ç»™hm_styleStoreæŒæœ‰</li>
<li>é€šè¿‡hm_configureWithTarget: cssAttribute: value:converterManager: å‡½æ•°å®é™…å»è®¾ç½®å¯¹åº”çš„ style å€¼</li>
</ol>
<h3 id="2-2-è®¾ç½®-Property-ï¼ˆæ¯”å¦‚-Text-çš„-text-å±æ€§ï¼‰"><a href="#2-2-è®¾ç½®-Property-ï¼ˆæ¯”å¦‚-Text-çš„-text-å±æ€§ï¼‰" class="headerlink" title="2.2 è®¾ç½® Property ï¼ˆæ¯”å¦‚ Text çš„ text å±æ€§ï¼‰"></a>2.2 è®¾ç½® Property ï¼ˆæ¯”å¦‚ Text çš„ text å±æ€§ï¼‰</h3><pre><code class="objective-c">// ä¸ç®¡æ˜¯ get è¿˜æ˜¯ set éƒ½æ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•
- (JSValueRef)hummerGetSetPropertyWithArgumentCount:(size_t)argumentCount arguments:(const JSValueRef _Nonnull[])arguments isSetter:(BOOL)isSetter &#123;
    ...
    // è¿™é‡Œä¸ºä»€ä¹ˆè¦æŠŠ argument[0] è½¬æˆ JSObjectRefï¼Ÿ
    JSObjectRef objectRef = NULL;
    if (JSValueIsObject(self.contextRef, arguments[0])) &#123;
        JSValueRef exception = NULL;
        objectRef = JSValueToObject(self.contextRef, arguments[0], &amp;exception);
        [self popExceptionWithErrorObject:&amp;exception];
    &#125;
    ...

    // è·å–å¯¹åº”çš„ç±»å
    NSString *className = [self convertValueRefToString:arguments[objectRef ? 1 : 0] isForce:NO];
    if (className.length == 0) &#123;
        return NULL;
    &#125;
    NSString *propertyName = [self convertValueRefToString:arguments[objectRef ? 2 : 1] isForce:NO];
    if (propertyName.length == 0) &#123;
        return NULL;
    &#125;

    id target = nil;
    SEL selector = nil;
    NSMethodSignature *methodSignature = nil;

    [self hummerExtractExportWithFunctionPropertyName:propertyName objectRef:objectRef target:&amp;target selector:&amp;selector methodSignature:&amp;methodSignature isSetter:isSetter jsClassName:className];
    // é€šè¿‡å¯¼å‡ºç±»ã€å¯¼å‡ºæ–¹æ³•ï¼Œè·å–åˆ°äº† Native ç±»ã€å¯¹åº”çš„æ–¹æ³•

    ...
    // è½¬å‘æ¶ˆæ¯ï¼Œè°ƒç”¨åŸç”Ÿæ–¹æ³•
    return [self hummerCallNativeWithArgumentCount:argumentCount arguments:arguments target:target selector:selector methodSignature:methodSignature];
&#125;

- (JSValueRef)hummerCallNativeWithArgumentCount:(size_t)argumentCount arguments:(JSValueRef const[])arguments target:(id)target selector:(SEL)selector methodSignature:(NSMethodSignature *)methodSignature &#123;
    ...
    BOOL isClass = object_isClass(target);
    NSMutableArray&lt;HMBaseValue *&gt; *otherArguments = nil;
    HMCurrentExecutor = self;
    // éšå«ç€ numerOfArguments + 0/1 &lt;= argumentCount
    for (NSUInteger i = methodSignature.numberOfArguments + (isClass ? 0 : 1); i &lt; argumentCount; ++i) &#123;
        // å¤šä½™çš„è½¬æ•°ç»„
        HMBaseValue *hummerValue = [[HMJSCStrongValue alloc] initWithValueRef:arguments[i] executor:HMCurrentExecutor];
        if (!otherArguments) &#123;
            otherArguments = [NSMutableArray arrayWithCapacity:argumentCount - methodSignature.numberOfArguments];
        &#125;
        if (hummerValue) &#123;
            [otherArguments addObject:hummerValue];
        &#125;
    &#125;
    // å­˜å‚¨é¢å¤–å‚æ•°
    HMOtherArguments = otherArguments.copy;
    NSInvocation *invocation = [NSInvocation invocationWithMethodSignature:methodSignature];
    invocation.target = target;
    invocation.selector = selector;
    // åç»­åšå¾ªç¯ï¼Œéƒ½æ˜¯ä¸´æ—¶å˜é‡ï¼Œå¦‚æœä¸åš retainï¼Œä¼šå¯¼è‡´é‡æŒ‡é’ˆ
    [invocation retainArguments];

    // å‚æ•°
    // æœ¬è´¨ä¸º MIN(methodSignature.numberOfArguments, argumentCount - (isClass : 0 : 1))ï¼Œä¸»è¦ä¸ºäº†é˜²æ­¢æ— ç¬¦å·æ•°å­—æº¢å‡º
    for (NSUInteger i = 2; i &lt; MIN(methodSignature.numberOfArguments + (isClass ? 0 : 1), argumentCount) - (isClass ? 0 : 1); ++i) &#123;
        const char *objCType = [methodSignature getArgumentTypeAtIndex:i];
        HMEncodingType type = HMEncodingGetType(objCType);
        id param = nil;
        if (type == HMEncodingTypeBlock) &#123;
            // Block
            param = [(HMJSCExecutor *) HMCurrentExecutor convertValueRefToFunction:arguments[i + (isClass ? 0 : 1)]];
        &#125; else if (type == HMEncodingTypeObject) &#123;
            // HMJSCValue
            param = [[HMJSCStrongValue alloc] initWithValueRef:arguments[i + (isClass ? 0 : 1)] executor:HMCurrentExecutor];
        &#125; else if (HMEncodingTypeIsCNumber(type)) &#123;
            // js åªå­˜åœ¨ double å’Œ bool ç±»å‹ï¼Œä½†åŸç”Ÿéœ€è¦åŒºåˆ†å…·ä½“ç±»å‹ã€‚
            param = [(HMJSCExecutor *) HMCurrentExecutor convertValueRefToNumber:arguments[i + (isClass ? 0 : 1)] isForce:NO];
        &#125; else &#123;
            HMLogError(HUMMER_UN_SUPPORT_TYPE_TEMPLATE, objCType);
        &#125;
        [invocation hm_setArgument:param atIndex:i encodingType:type];
    &#125;
    // æ‹¼è£…å®Œæ¯•ï¼Œæ‰§è¡Œæ–¹æ³•
    [invocation invoke];
    HMOtherArguments = nil;
    // è¿”å›å€¼
    JSValueRef returnValueRef = NULL;
    const char *objCReturnType = methodSignature.methodReturnType;
    HMEncodingType returnType = HMEncodingGetType(objCReturnType);
    if (returnType != HMEncodingTypeVoid &amp;&amp; returnType != HMEncodingTypeUnknown) &#123;
        id returnObject = [invocation hm_getReturnValueObject];
        if (returnObject) &#123;
            returnValueRef = [(HMJSCExecutor *) HMCurrentExecutor convertObjectToValueRef:returnObject];
        &#125;
    &#125;
    HMCurrentExecutor = nil;

    return returnValueRef;
&#125;
</code></pre>
<p>ç»§ç»­ç²—æš´æè¿°ï¼š</p>
<ol>
<li>è·å–åˆ° Native ä¾§å·²ç»æ³¨å†Œçš„ç±»åï¼Œè·å–åˆ° getter å’Œ setter</li>
<li>æ‹¼è£…NSInvocationï¼Œå¤„ç†å‚æ•°ï¼Œç„¶åè°ƒç”¨ invoke æ–¹æ³•æ‰§è¡ŒNative çš„ getter å’Œ setter</li>
<li>æ‰§è¡Œå®Œæˆåï¼Œè·å–è¿”å›å€¼</li>
<li>æœ€åæŠŠJSValueRefè¿”å›ç»™JSC(æˆ‘ç†è§£å°±æ˜¯ Hummer ä¾§)</li>
</ol>
<h3 id="3-renderæ¸²æŸ“"><a href="#3-renderæ¸²æŸ“" class="headerlink" title="3 renderæ¸²æŸ“"></a>3 renderæ¸²æŸ“</h3><p>è¯¥åˆ›å»ºçš„åˆ›äº†ï¼Œè¯¥è®¾ç½®çš„è®¾äº†ï¼Œç„¶åå¾—æŠŠå®ƒä»¬æ¸²æŸ“åˆ°å±å¹•ä¸Š</p>
<pre><code class="objective-c">- (void)render:(HMBaseValue *)page &#123;
    id&lt;HMBaseExecutorProtocol&gt; executor = page.context;
    HMJSContext *context = [HMJSGlobal.globalObject currentContext:executor ? executor : HMCurrentExecutor];
    context.didCallRender = YES;
    // é‡Œé¢è¿˜æ˜¯ç”¨ HMJSCExecutor å°† HMBaseValue è½¬æˆå…·ä½“çš„ç±»ï¼Œæ¯”å¦‚ UIView
    NSObject *viewObject = page.toNativeObject;
    if (!viewObject || ![viewObject isKindOfClass:UIView.class]) &#123;
        return;
    &#125;
    UIView *view = (UIView *) viewObject;
    [context didRenderPage:page nativeView:view];
&#125;

- (void)didRenderPage:(HMBaseValue *)page nativeView:(nonnull UIView *)view&#123;
    
    self.componentView = page;
    // æŠŠè¿™ä¸ª View æ·»åŠ åˆ°å±å¹•ä¸Š(ä¼šè°ƒç”¨ Yoga æŠŠèŠ‚ç‚¹æ’å…¥åˆ°èŠ‚ç‚¹æ ‘ä¸Š)
    [self.rootView addSubview:view];
    self.rootView.isHmLayoutEnabled = YES;
    [self.rootView hm_markDirty];
    if ([self.delegate respondsToSelector:@selector(context:didRenderPage:)]) &#123;
        [self.delegate context:self didRenderPage:page];
    &#125;
    if (self.renderCompletion) &#123;
        self.renderCompletion();
    &#125;
    // æ’åºå½“å‰è§†å›¾
    [UIView hm_reSortFixedView:self];
    ...
&#125;
</code></pre>
<p>å¤æ‚åœ°æ¦‚æ‹¬ä¸‹ï¼š</p>
<ol>
<li>å°† page è½¬æˆ Native çš„ UIView å¯¹è±¡</li>
<li>æ¸²æŸ“ UIView</li>
<li>æŠŠè¿™ä¸ª UIView æ·»åŠ åˆ° rootView ä¸Šï¼Œæ’å…¥åˆ° YogaèŠ‚ç‚¹æ ‘</li>
</ol>
<h3 id="4-markDirtyï¼š"><a href="#4-markDirtyï¼š" class="headerlink" title="4 markDirtyï¼š"></a>4 markDirtyï¼š</h3><pre><code class="objective-c">- (void)hm_markDirty &#123;
    if (!self.isHmLayoutEnabled) &#123;
        return;
    &#125;

    // 1. å¶èŠ‚ç‚¹ -&gt; å¶èŠ‚ç‚¹ï¼ˆè„ï¼‰ï¼Œéœ€è¦ markDirty + setNeedsLayout
    // 2. å®¹å™¨èŠ‚ç‚¹ -&gt; å®¹å™¨èŠ‚ç‚¹ï¼ˆè„ï¼‰ï¼Œåªéœ€è¦ setNeedsLayout
    // 3. å¶èŠ‚ç‚¹ -&gt; å®¹å™¨èŠ‚ç‚¹ï¼ˆè„ï¼‰ï¼Œåªéœ€è¦ setNeedsLayout
    // 4. å®¹å™¨èŠ‚ç‚¹ -&gt; å¶èŠ‚ç‚¹ï¼ˆè„ï¼‰ï¼Œåªéœ€è¦ setNeedsLayout
    // YGAttachNodesFromViewHierachy ä¼šé’ˆå¯¹ 2 3 4 æƒ…å†µè‡ªè¡Œåšå‡ºæ ‡è®°è„èŠ‚ç‚¹çš„åŠ¨ä½œ
    if (self.hm_renderObject.numberOfChildren == 0 &amp;&amp; self.hm_renderObject.isLeaf) &#123;
        // åŸå…ˆæ˜¯å¶èŠ‚ç‚¹ï¼Œç°åœ¨ä¹Ÿæ˜¯å¶èŠ‚ç‚¹
        [self.hm_renderObject markDirty];
    &#125;
    NSAssert(NSThread.isMainThread, @&quot;å¿…é¡»æ˜¯ä¸»çº¿ç¨‹&quot;);
    if (!viewSet) &#123;
        viewSet = NSHashTable.weakObjectsHashTable;
        dispatch_async(dispatch_get_main_queue(), ^&#123;
            // å¸ƒå±€å¯¹åº”çš„ Viewï¼ˆæœ€ç»ˆæ˜¯é€šè¿‡ frame çš„æ–¹å¼è¿›è¡Œå¸ƒå±€çš„ï¼‰
            [UIView hm_layoutIfNeeded];
        &#125;);
    &#125;
    [viewSet addObject:self];
&#125;
</code></pre>
<h3 id="5-layout-å¸ƒå±€"><a href="#5-layout-å¸ƒå±€" class="headerlink" title="5 layout å¸ƒå±€"></a>5 layout å¸ƒå±€</h3><pre><code class="objective-c">+ (void)hm_layoutIfNeeded &#123;
    if (viewSet.count == 0) &#123;
        return;
    &#125;
    NSHashTable&lt;__kindof UIView *&gt; *rootViewSet = nil;
    // viewSet æ˜¯é™æ€å˜é‡ï¼Œæˆ‘çŒœæµ‹
    NSEnumerator&lt;__kindof UIView *&gt; *enumerator = viewSet.objectEnumerator;
    UIView *value = nil;
    // æ‰¾åˆ° yoga èŠ‚ç‚¹æ ‘çš„ rootView
    while ((value = enumerator.nextObject)) &#123;
        UIView *rootView = hm_yoga_get_root_view(value);
        if (!rootViewSet) &#123;
            rootViewSet = NSHashTable.weakObjectsHashTable;
        &#125;
        [rootViewSet addObject:rootView];
    &#125;
    viewSet = nil;
    enumerator = rootViewSet.objectEnumerator;
    // è°ƒç”¨ yoga è¿›è¡Œå¸ƒå±€
    while ((value = enumerator.nextObject)) &#123;
        [value hm_layoutYogaRootView];
    &#125;
&#125;

// æœ€ç»ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼š
// preserveOriginpreserveOrigin ä¸º YESï¼Œè¡¨ç¤ºå¸ƒå±€çš„æ—¶å€™ç»§æ‰¿ä¸Šä¸€æ¬¡çš„ frame
- (void)applyLayoutPreservingOrigin:(BOOL)preserveOriginpreserveOrigin dimensionFlexibility:(HummerDimensionFlexibility)dimensionFlexibility view:(UIView *)view affectedShadowViews:(NSHashTable&lt;HMRenderObject *&gt; *)affectedShadowViews &#123;
    // æŠŠ View æ’å…¥åˆ° yoga èŠ‚ç‚¹æ ‘ä¸­
    [self attachRenderObjectFromViewHierarchyForRootView:view];

    if (!affectedShadowViews) &#123;
        affectedShadowViews = [NSHashTable weakObjectsHashTable];
    &#125;
    HMRenderObject *renderObject = (HMRenderObject *) view.hm_renderObject;
    HMRootRenderObject *rootRenderObject = [[HMRootRenderObject alloc] init];
    rootRenderObject.renderObject = renderObject;
    
    // æœ€å°å¤§å°ç›´æ¥å¿½ç•¥
    CGSize oldMinimumSize = CGSizeMake(HMCoreGraphicsFloatFromYogaValue(YOGA_TYPE_WRAPPER(YGNodeStyleGetMinWidth)(renderObject.yogaNode), 0), HMCoreGraphicsFloatFromYogaValue(YOGA_TYPE_WRAPPER(YGNodeStyleGetMinHeight)(renderObject.yogaNode), 0));
    if (!CGSizeEqualToSize(oldMinimumSize, rootRenderObject.minimumSize)) &#123;
        rootRenderObject.minimumSize = oldMinimumSize;
    &#125;
    // é»˜è®¤ç›´æ¥ä½¿ç”¨ rootView å¤§å°
    rootRenderObject.availableSize = view.bounds.size;
    if (dimensionFlexibility &amp; HummerDimensionFlexibilityWidth) &#123;
        CGSize availableSize = rootRenderObject.availableSize;
        availableSize.width = CGFLOAT_MAX;
        rootRenderObject.availableSize = availableSize;
    &#125;
    if (dimensionFlexibility &amp; HummerDimensionFlexibilityWidth) &#123;
        CGSize availableSize = rootRenderObject.availableSize;
        availableSize.height = CGFLOAT_MAX;
        rootRenderObject.availableSize = availableSize;
    &#125;
    // è°ƒç”¨ yoga è¿›è¡Œå¸ƒå±€
    [rootRenderObject layoutWithAffectedShadowViews:affectedShadowViews];

    if (affectedShadowViews.count &lt;= 0) &#123;
        // no frame change results in no UI update block
        return;
    &#125;
    for (HMRenderObject *shadowView in affectedShadowViews) &#123;
        HMLayoutMetrics layoutMetrics = shadowView.layoutMetrics;
        UIView *inlineView = shadowView.view;
        hm_safe_main_thread(^&#123;
            inlineView.hm_animationPropertyBounds = inlineView.bounds;
            inlineView.hm_animationPropertyCenter = inlineView.center;
            CGRect frame = layoutMetrics.frame;
            // åªæœ‰åœ¨ HMDisplayTypeNone æˆ– visibility: hidden æƒ…å†µä¸‹ï¼Œéšè—è§†å›¾
            BOOL isHidden = layoutMetrics.displayType == HMDisplayTypeNone || inlineView.hm_visibility == YES;
            if (inlineView.isHidden != isHidden) &#123;
                inlineView.hidden = isHidden;
            &#125;
            if (view == inlineView) &#123;
                // éœ€è¦ç»§æ‰¿ä¸Šæ¬¡çš„ origin
                if (preserveOrigin) &#123;
                    frame = (CGRect) &#123;
                            .origin = &#123;
                                    .x = (CGRectGetMinX(frame) + inlineView.frame.origin.x),
                                    .y = (CGRectGetMinY(frame) + inlineView.frame.origin.y),
                            &#125;,
                            .size = frame.size
                    &#125;;
                &#125;
            &#125;
            // ä¸º shadowView è®¾ç½® frame
            [inlineView hummerSetFrame:frame];
        &#125;);
    &#125;
&#125;
</code></pre>
<blockquote>
<p>shadowView æ˜¯ä»€ä¹ˆï¼Ÿâ€”â€”è¾…åŠ©ç±»ï¼Œè´Ÿè´£åœ¨ shadow çº¿ç¨‹è¿›è¡Œå¸ƒå±€ç›¸å…³çš„è®¡ç®—</p>
</blockquote>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„ Text ç»„ä»¶å°±æ·»åŠ åˆ°äº†å±å¹•ä¸Šï¼Œå¹¶æœ€ç»ˆæ˜¾ç¤ºäº†å‡ºæ¥</p>
<p><img src="/image/image_GR5FJw9Zmq.png"></p>
<p><img src="/image/image_BDt3lrxuia.png"></p>
<hr>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Hummer çš„æ¸²æŸ“æœºåˆ¶è·Ÿ ReactNative çš„æ¯”è¾ƒåƒï¼š</p>
<p><img src="/image/Hummer%E6%B8%B2%E6%9F%93_6CexzvtQEf.png"></p>
<p>ä¸è¿‡è¿˜æ˜¯æœ‰å¾ˆå¤šé—®é¢˜æµ®ç°äº†å‡ºæ¥ï¼š</p>
<ol>
<li>å¦‚æœç»„ä»¶å‘ç”Ÿäº†æ”¹å˜ï¼ŒHummer æ˜¯å¦‚ä½•åˆ·æ–°è§†å›¾æ ‘çš„å‘¢ï¼Ÿ</li>
<li>hummerCreate å‡½æ•°æ˜¯æ€ä¹ˆä¸€æ­¥æ­¥ä» Hummer ä¾§è°ƒç”¨çš„å‘¢ï¼Ÿè¿˜æœ‰ render:ï¼Ÿ</li>
<li>Native å’Œ JS æ˜¯å¦‚ä½•é€šä¿¡çš„ï¼Ÿ</li>
<li>Hummer çš„å¯åŠ¨æµç¨‹éƒ½åšäº†äº›ä»€ä¹ˆï¼Ÿ</li>
</ol>
<p>è¿™äº›é—®é¢˜æˆ‘ä¼šåœ¨åç»­çš„æ–‡ç« ä¸­é€æ¸è¿›è¡Œè§£ç­”ã€‚</p>
<h3 id="è‡ªæµ‹ä¹ é¢˜"><a href="#è‡ªæµ‹ä¹ é¢˜" class="headerlink" title="è‡ªæµ‹ä¹ é¢˜"></a>è‡ªæµ‹ä¹ é¢˜</h3><p>æ ¹æ®ã€Šè®¤çŸ¥å¤©æ€§ã€‹ï¼Œè€ƒè¯•æ˜¯æœ€æœ‰æ•ˆçš„å­¦ä¹ ç­–ç•¥ä¹‹ä¸€ï¼Œä½ èƒ½è§£ç­”ä¸‹é¢çš„é—®é¢˜å—ï¼š</p>
<p><strong>ä¸ºä»€ä¹ˆä»¥ä¸‹å†™æ³•ä¸èƒ½ç”Ÿæ•ˆï¼Ÿ</strong></p>
<pre><code class="typescript">text.style.color = &#39;#ffffff&#39;
</code></pre>
<p><img src="/image/image_o7Bw64ThP5.png"></p>
<p>ã€‚</p>
<p>ã€‚</p>
<p>ã€‚</p>
<p>ã€‚</p>
<p>è¯·è¯¸å›æ€è€ƒï¼Œæ€è€ƒ</p>
<p>ã€‚</p>
<p>ã€‚</p>
<p>ã€‚</p>
<p>è§£ç­”ï¼š<strong>é‚£ç§å†™æ³•ä¼šè°ƒç”¨ getter è€Œä¸æ˜¯ setterï¼Œä¹Ÿå°±æ˜¯hm_style: æ–¹æ³•ï¼Œè€Œä¸æ˜¯hm_setStyle: æ–¹æ³•ã€‚å½“ç„¶ä¸ä¼šç”Ÿæ•ˆã€‚</strong></p>
<hr>
<p><strong>ä¸ºä»€ä¹ˆè¿™è¡Œä»£ç æ”¾åœ¨ä¸€å¼€å§‹å°±ä¼šå¯¼è‡´render ä¸æ‰§è¡Œï¼Ÿ</strong></p>
<pre><code class="objective-c">appendText(message:string)&#123;
    var text = new Text()

    // æ”¾åœ¨è¿™é‡Œ, ç»ƒrender å‡½æ•°éƒ½ä¸ä¼šè°ƒç”¨äº†ï¼Œä¸ºå•¥ï¼Ÿ
    text.style.color = &#39;#666666&#39;

    text.style = &#123;
      fontSize: 20,
    &#125;

    text.style = &#123;
      color: &#39;#999999&#39;
    &#125;

    // æ”¾åœ¨è¿™é‡Œï¼Œä¸ç”Ÿæ•ˆï¼Œå› ä¸ºè¿™è¡Œä»£ç ç¿»è¯‘è¿‡å»æ˜¯è°ƒç”¨äº† getter è€Œä¸æ˜¯ setter
    text.style.color = &#39;#666666&#39;

    text.text = message
    this.appendChild(text);
  &#125;
</code></pre>
<p>æš‚æ—¶æ²¡ç­”æ¡ˆï¼Œæˆ‘çŒœæ˜¯å› ä¸ºè°ƒç”¨ getter åå¾—åˆ°çš„è¿”å›å€¼ç±»å‹ä¸å¯¹ï¼Œå¯¼è‡´åé¢çš„ä»£ç ä¸æ‰§è¡Œäº†ï¼Ÿ</p>
<h3 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h3><ul>
<li>è·¨ç«¯æ¡†æ¶ Hummer é€šä¿¡æœºåˆ¶ - iOS ç‰ˆï¼ˆæ»´æ»´å†…éƒ¨èµ„æ–™ï¼‰</li>
<li><a href="https://juejin.cn/post/6844904003692658701#heading-9" title="ReactNative æºç è§£æ â€”â€” æ¸²æŸ“æœºåˆ¶è¯¦è§£">ReactNative æºç è§£æ â€”â€” æ¸²æŸ“æœºåˆ¶è¯¦è§£</a></li>
<li><a href="https://juejin.cn/post/6844904184542822408#heading-14" title="ã€ŒReactNative åŸç†ã€ Native å±‚çš„æ¸²æŸ“æµç¨‹">ã€ŒReactNative åŸç†ã€ Native å±‚çš„æ¸²æŸ“æµç¨‹</a></li>
<li><a href="https://www.jianshu.com/p/7e7b462c187b" title="è¯¦è§£ React Native æ¸²æŸ“åŸç†">è¯¦è§£ React Native æ¸²æŸ“åŸç†</a></li>
<li><a href="https://hummer.didi.cn/home#/" title="Hummer">Hummer</a></li>
</ul>

      
       <hr><span style="font-style: italic;color: gray;"> è½¬è½½è¯·æ³¨æ˜æ¥æºï¼Œæ¬¢è¿å¯¹æ–‡ç« ä¸­çš„å¼•ç”¨æ¥æºè¿›è¡Œè€ƒè¯ï¼Œæ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚å¯ä»¥åœ¨ä¸‹é¢è¯„è®ºåŒºè¯„è®ºï¼Œä¹Ÿå¯ä»¥é‚®ä»¶è‡³ wymannpan@foxmail.com </span>
    </div>
</article>







    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    Â©2021-2022  æ·®
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*æ¸²æŸ“å¯¹åº”çš„è¡¨æ ¼æ ·å¼*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*æ¸²æŸ“æ‰“èµæ ·å¼*/
        

        /*é«˜äº®ä»£ç å—è¡Œå·*/
        

        /*è®¿é—®æ•°é‡*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*ä»£ç é«˜äº®ï¼Œè¡Œå·å¯¹é½*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*æ‰“èµé¡µé¢éšè—ä¸å±•ç¤º*/
    

</script>

<!--åŠ å…¥è¡Œå·çš„é«˜äº®ä»£ç å—æ ·å¼-->

<!--è‡ªå®šä¹‰æ ·å¼è®¾ç½®-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*åˆ—è¡¨æ ·å¼*/
    

    /* èƒŒæ™¯å›¾æ ·å¼ */
    
    


    /*å¼•ç”¨å—æ ·å¼*/
    

    /*æ–‡ç« åˆ—è¡¨èƒŒæ™¯å›¾*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("https://img1.artron.net/auction/2020/art517681/d/art5176810663.jpg");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>






<div class="mobile-menus-out" >

</div>
<div class="mobile-menus">
    
    
    <a class="dynamic-menu site_url"   href="/photo">ç›¸å†Œ</a>
    
    
    <a class="dynamic-menu " target="_self"   href="http://yelog.org/">å¶è½é˜</a>
    
    
    <a class="dynamic-menu " target="_blank"  href="https://github.com/yelog">github</a>
    
</div>


</html>
